================================================================================
                  حالات اختبار الأمان
                   نظام التجارة الإلكترونية الآمن
================================================================================

╔══════════════════════════════════════════════════════════════════════════════╗
║                    اختبار 1: محاولة اختراق الصلاحيات                         ║
╚══════════════════════════════════════════════════════════════════════════════╝

📍 سيناريو: CS_AGENT يحاول الوصول لبيانات غير مصرحة
----------------------------------------------------------

-- اتصل كـ CS_AGENT
-- محاولة 1: الوصول لسعر التكلفة (يجب أن يفشل)
SELECT PRODUCT_NAME, COST_PRICE FROM ECOM_OWNER.PRODUCTS;
-- النتيجة المتوقعة: ORA-00904: "COST_PRICE": invalid identifier
-- أو لا صلاحية

-- محاولة 2: حذف عميل (يجب أن يفشل)
DELETE FROM ECOM_OWNER.CUSTOMERS WHERE CUSTOMER_ID = 1;
-- النتيجة المتوقعة: ORA-01031: insufficient privileges

-- محاولة 3: تعديل مبلغ الطلب (يجب أن يفشل)
UPDATE ECOM_OWNER.ORDERS SET TOTAL_AMOUNT = 0 WHERE ORDER_ID = 1;
-- النتيجة المتوقعة: ORA-01031: insufficient privileges

╔══════════════════════════════════════════════════════════════════════════════╗
║                    اختبار 2: تجاوز VPD                                       ║
╚══════════════════════════════════════════════════════════════════════════════╝

📍 سيناريو: محاولة رؤية بيانات عميل غير مصرح
----------------------------------------------------------

-- كـ CS_AGENT المعين لـ ASSIGNED_AGENT = 'CS_AGENT'
SELECT COUNT(*) FROM ECOM_OWNER.CUSTOMERS;
-- يجب أن يعرض فقط العملاء المعينين له

-- محاولة الوصول لعميل محدد غير معين له
SELECT * FROM ECOM_OWNER.CUSTOMERS WHERE ASSIGNED_AGENT = 'OTHER_AGENT';
-- النتيجة المتوقعة: لا توجد صفوف (VPD يحجب البيانات)

╔══════════════════════════════════════════════════════════════════════════════╗
║                    اختبار 3: SQL Injection                                   ║
╚══════════════════════════════════════════════════════════════════════════════╝

📍 سيناريو: محاولة حقن SQL
----------------------------------------------------------

-- الإجراءات المخزنة تستخدم Bind Variables لمنع SQL Injection
-- مثال على استعلام آمن:
SELECT * FROM ECOM_OWNER.CUSTOMERS WHERE EMAIL = :email_param;

-- محاولة حقن (لن تعمل مع Bind Variables):
-- :email_param = "' OR '1'='1"
-- النتيجة: لن يتم تنفيذ الحقن

╔══════════════════════════════════════════════════════════════════════════════╗
║                    اختبار 4: كلمات المرور الضعيفة                            ║
╚══════════════════════════════════════════════════════════════════════════════╝

📍 سيناريو: محاولة تعيين كلمة مرور ضعيفة
----------------------------------------------------------

-- كـ SYS:
ALTER USER CS_AGENT IDENTIFIED BY "weak";
-- النتيجة المتوقعة: ORA-20001: Password must be at least 12 characters

ALTER USER CS_AGENT IDENTIFIED BY "weakpassword1";
-- النتيجة المتوقعة: ORA-20002: Password must contain uppercase letter

ALTER USER CS_AGENT IDENTIFIED BY "Weakpassword1";
-- النتيجة المتوقعة: ORA-20005: Password must contain special character

-- كلمة مرور صحيحة:
ALTER USER CS_AGENT IDENTIFIED BY "StrongPass@2024";
-- النتيجة: نجاح

╔══════════════════════════════════════════════════════════════════════════════╗
║                    اختبار 5: قفل الحساب                                      ║
╚══════════════════════════════════════════════════════════════════════════════╝

📍 سيناريو: محاولات دخول فاشلة متكررة
----------------------------------------------------------

-- حاول تسجيل الدخول 5 مرات بكلمة مرور خاطئة:
-- sqlplus CS_AGENT/wrong_password@ECOM_PDB (كرر 5 مرات)

-- تحقق من حالة الحساب:
SELECT USERNAME, ACCOUNT_STATUS FROM DBA_USERS WHERE USERNAME = 'CS_AGENT';
-- النتيجة المتوقعة: LOCKED(TIMED)

-- فك القفل:
ALTER USER CS_AGENT ACCOUNT UNLOCK;

╔══════════════════════════════════════════════════════════════════════════════╗
║                    اختبار 6: التدقيق يسجل كل شيء                             ║
╚══════════════════════════════════════════════════════════════════════════════╝

📍 سيناريو: التحقق من تسجيل العمليات
----------------------------------------------------------

-- نفذ عملية حساسة
SELECT NATIONAL_ID FROM ECOM_OWNER.CUSTOMERS WHERE ROWNUM = 1;

-- تحقق من التسجيل (كـ AUDITOR):
SELECT EVENT_TIMESTAMP, DBUSERNAME, ACTION_NAME, SQL_TEXT
FROM UNIFIED_AUDIT_TRAIL
WHERE OBJECT_NAME = 'CUSTOMERS'
AND EVENT_TIMESTAMP > SYSTIMESTAMP - INTERVAL '5' MINUTE
ORDER BY EVENT_TIMESTAMP DESC;
-- يجب أن تظهر العملية في السجل

╔══════════════════════════════════════════════════════════════════════════════╗
║                    ملخص نتائج الاختبار                                       ║
╚══════════════════════════════════════════════════════════════════════════════╝

رقم │ الاختبار                         │ المتوقع    │ النتيجة
────┼──────────────────────────────────┼────────────┼─────────
 1  │ CS_AGENT يقرأ COST_PRICE         │ فشل       │ [  ]
 2  │ CS_AGENT يحذف CUSTOMERS          │ فشل       │ [  ]
 3  │ VPD يحجب البيانات غير المصرحة    │ نجاح      │ [  ]
 4  │ منع كلمة المرور الضعيفة          │ فشل       │ [  ]
 5  │ قفل الحساب بعد 5 محاولات         │ نجاح      │ [  ]
 6  │ التدقيق يسجل العمليات             │ نجاح      │ [  ]

================================================================================
                         نهاية اختبارات الأمان
================================================================================
