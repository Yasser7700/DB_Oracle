/*
================================================================================
    04_Data_Dictionary.sql - قاموس البيانات والبيانات الحساسة
    نظام التجارة الإلكترونية الآمن Oracle 19c
================================================================================
*/

PROMPT إنشاء قاموس البيانات...

-- جدول تصنيف البيانات الحساسة
CREATE TABLE DATA_CLASSIFICATION (
    CLASSIFICATION_ID   NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    TABLE_NAME         VARCHAR2(100) NOT NULL,
    COLUMN_NAME        VARCHAR2(100) NOT NULL,
    DATA_TYPE          VARCHAR2(50),
    SENSITIVITY_LEVEL  VARCHAR2(20) CHECK (SENSITIVITY_LEVEL IN ('PUBLIC','INTERNAL','CONFIDENTIAL','RESTRICTED')),
    PII_INDICATOR      CHAR(1) DEFAULT 'N' CHECK (PII_INDICATOR IN ('Y','N')),
    ENCRYPTION_REQUIRED CHAR(1) DEFAULT 'N' CHECK (ENCRYPTION_REQUIRED IN ('Y','N')),
    MASKING_REQUIRED   CHAR(1) DEFAULT 'N' CHECK (MASKING_REQUIRED IN ('Y','N')),
    DESCRIPTION_AR     VARCHAR2(500),
    GDPR_CATEGORY      VARCHAR2(100),
    RETENTION_DAYS     NUMBER,
    CONSTRAINT UK_DATA_CLASS UNIQUE (TABLE_NAME, COLUMN_NAME)
);

-- تصنيف بيانات جدول CUSTOMERS
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','CUSTOMER_ID','NUMBER','PUBLIC','N','N','N','المعرف','Identifier',NULL);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','FIRST_NAME','VARCHAR2','CONFIDENTIAL','Y','N','Y','الاسم الأول','Personal Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','LAST_NAME','VARCHAR2','CONFIDENTIAL','Y','N','Y','اسم العائلة','Personal Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','EMAIL','VARCHAR2','CONFIDENTIAL','Y','N','Y','البريد الإلكتروني','Contact Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','PHONE','VARCHAR2','CONFIDENTIAL','Y','N','Y','رقم الهاتف','Contact Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','NATIONAL_ID','VARCHAR2','RESTRICTED','Y','Y','Y','رقم الهوية','Government ID',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','DATE_OF_BIRTH','DATE','CONFIDENTIAL','Y','N','Y','تاريخ الميلاد','Personal Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'CUSTOMERS','PASSWORD_HASH','VARCHAR2','RESTRICTED','N','Y','N','تجزئة كلمة المرور','Authentication',365);

-- تصنيف بيانات جدول PAYMENTS
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'PAYMENTS','CARD_LAST_FOUR','VARCHAR2','INTERNAL','Y','N','N','آخر 4 أرقام','Payment Card Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'PAYMENTS','CARD_TOKEN','VARCHAR2','RESTRICTED','Y','Y','N','توكن البطاقة','Payment Card Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'PAYMENTS','AMOUNT','NUMBER','CONFIDENTIAL','N','N','N','مبلغ الدفع','Financial Data',2555);

-- تصنيف بيانات جدول ADDRESSES
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'ADDRESSES','ADDRESS_LINE1','VARCHAR2','CONFIDENTIAL','Y','N','Y','العنوان','Location Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'ADDRESSES','CITY','VARCHAR2','INTERNAL','Y','N','N','المدينة','Location Data',2555);
INSERT INTO DATA_CLASSIFICATION VALUES (DEFAULT,'ADDRESSES','POSTAL_CODE','VARCHAR2','INTERNAL','Y','N','Y','الرمز البريدي','Location Data',2555);

COMMIT;

PROMPT ========================================
PROMPT ملخص تصنيف البيانات:
PROMPT ========================================

SELECT SENSITIVITY_LEVEL, COUNT(*) AS COLUMNS_COUNT,
       SUM(CASE WHEN PII_INDICATOR='Y' THEN 1 ELSE 0 END) AS PII_COLUMNS
FROM DATA_CLASSIFICATION
GROUP BY SENSITIVITY_LEVEL
ORDER BY DECODE(SENSITIVITY_LEVEL,'RESTRICTED',1,'CONFIDENTIAL',2,'INTERNAL',3,'PUBLIC',4);

PROMPT تم إنشاء قاموس البيانات ✓
